# Teams app CI/CD transparent guide
This document provide guidance on how to setup CI/CD pipeline for teams app created with the Teams Toolkit using your custom approach.

## Custom Deployment Approach
The most convenient way to deploy teams app is using [teamsapp CLI](https://learn.microsoft.com/en-us/microsoftteams/platform/toolkit/teams-toolkit-cli?pivots=version-three)'s `teamspp deploy` command. If you're unable to leverage the teamsapp CLI within your pipeline, you can create a custom deployment process tailored to your needs.

The `teamsapp deploy` command executes the actions in teamsapp.yml's "deploy" stage and this stage contains 2 parts: build and deploy. What you need to do is rewritting these actions into your own way.

Taking basic bot typescript project as an example, it's teamsapp.yml's deploy stage is as following:
```yml
deploy:
  # Run npm command
  - uses: cli/runNpmCommand
    name: install dependencies
    with:
      args: install
  - uses: cli/runNpmCommand
    name: build app
    with:
      args: run build --if-present
  # Deploy your application to Azure App Service using the zip deploy feature.
  # For additional details, refer to https://aka.ms/zip-deploy-to-app-services.
  - uses: azureAppService/zipDeploy
    with:
      # Deploy base folder
      artifactFolder: .
      # Ignore file location, leave blank will ignore nothing
      ignoreFile: .webappignore
      # The resource id of the cloud resource to be deployed to.
      # This key will be generated by arm/deploy action automatically.
      # You can replace it with your existing Azure Resource id
      # or add it to your environment variable file.
      resourceId: ${{BOT_AZURE_APP_SERVICE_RESOURCE_ID}}
```
These actions will first run `npm build` to build the project, then deploy the code to Azure app service. You can rewrite these actions in your CI/CD pipleline in your own way. 

Below is an example of using GitHub official actions:
```yml
    # build
    - name: Setup Node 18.x
      uses: actions/setup-node@v1
      with:
        node-version: '18.x'
    - name: 'npm install, build'
      run: |
        npm install
        npm run build --if-present

    - name: 'zip artifact for deployment'
      run: |
        zip -r deploy.zip . --include 'node_modules/*' 'lib/*' 'web.config'

    # deploy
    - name: 'Login via Azure CLI'
      uses: azure/login@v1
      with:
        client-id: ${{ vars.CLIENT_ID }}
        tenant-id: ${{ vars.TENANT_ID }}
        subscription-id: ${{ vars.SUBSCRIPTION_ID }}

    - name: 'Run Azure webapp deploy action using azure RBAC'
      uses: azure/webapps-deploy@v2
      with:
        app-name: ${{ vars.AZURE_WEBAPP_NAME }}
        package: deploy.zip
```
Below are some Official actions for your reference:

Build:

| language      | GitHub                    |Azure Pipeline
|---------------------------------------------------|-------------------------------|----|
| JS/TS                | [actions/setup-node](https://github.com/actions/setup-node) <br> script: npm install.. |[NodeTool@0](https://learn.microsoft.com/en-us/azure/devops/pipelines/tasks/reference/node-tool-v0?view=azure-pipelines) <br> script: npm install…| 
| C#      | [actions/setup-dotnet](https://github.com/actions/setup-dotnet) <br>script: dotnet build… |[DotNetCoreCLI@2](https://learn.microsoft.com/en-us/azure/devops/pipelines/tasks/reference/dotnet-core-cli-v2?view=azure-pipelines)|


Deploy:

| resource   | GitHub                  |Azure Pipeline
|---------------------------------------------------|-------------------------------|----|
| App Service               |[azure/webapps-deploy](https://github.com/Azure/webapps-deploy)| [AzureWebApp@1](https://learn.microsoft.com/en-us/azure/devops/pipelines/tasks/reference/azure-web-app-v1?view=azure-pipelines)
| Function          |[Azure/functions-action](https://github.com/Azure/functions-action)|[AzureFunctionApp@2](https://learn.microsoft.com/en-us/azure/devops/pipelines/tasks/reference/azure-function-app-v2?view=azure-pipelines)
| Static Web App             |[Azure/static-web-apps-deploy](https://github.com/Azure/static-web-apps-deploy)| [AzureStaticWebApp@0](https://learn.microsoft.com/en-us/azure/devops/pipelines/tasks/reference/azure-static-web-app-v0?view=azure-pipelines)|

